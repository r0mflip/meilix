language: generic
include:
- os: linux
  addons:
    apt:
      update: true
      sources:
      - ubuntu-toolchain-r-test
      packages:
      - debootstrap
      - genisoimage
      - p7zip-full
      - squashfs-tools
      - ubuntu-dev-tools
      - dpkg-dev
      - debhelper
      - fakeroot
      - devscripts
sudo: required
git:
  depth: 22
script:
- export LC_ALL=en_US.UTF-8
- export LANG=en_US.UTF-8
- export LANGUAGE=en_US.UTF-8
- chmod +x ./build.sh
- "./build.sh |& tee log.txt"
before_deploy:
- export image_name="`echo *.iso`"
- cat *.iso > "/home/travis/${image_name}"
deploy:
- provider: releases
  skip_cleanup: true
  api_key:
    secure: "IVKH6H5uu8m991p4CIGPjnkvcyHCRCUdQBHE2g0dfbqyZ2A6NSKPRM9l8KJ9w6RG1Z2ENI+ebgkO5LmWqJk4PQ7m5xKWQwvlCB6Sy+kNDh9w3G7IujF3g4P2EBhh7uOXNkOO81X+GL+xNMYN5x3Za5mGzcv+azDSi+e4jO13eNFwlwIPyHv54mwquisDai/IrcLFhk/C09fBeYcOIQFmxoz1GhoBwHKh099UlMYP5iNVP7qKzJMYrlzUrycxUyYtnTubsGEFIgpOSAIZXqZ/K6ghBgMfFOCnO2gGw0byac8snMAGvL9HyTit63c/8EHsrsfQ2JxLyKqf5WVvb7zickZPqpsX9Hma520PF5amMPLxa7rSHlGDhqQgvE/8rj/9IqKl4HnSJ3RUQfclOmv6Mjq7WlXj2w0U7UTzsvwRzeCMUCLHMb5/UOxIGA4I3P2nwLV8NHGxMV6JJT9wtp18nw0Cj+Cc+3oIeYFKlMFFxQKvitenNknmHxMtlYIZLItd6VYJuvyPeF91DOTnHe5NjieOPcmKnG22f/03y3JVXyiB+z344xWY3Trf62oa+RiL5EW4jG/8T7i5hkmaPQI4kE7xx78MziquFP6+BUdNZ0Mvjd38jRVkYVj5TzCLuZYuMNbu2cRjgYKUW84e2BN9xfvN7IzkrGspiHDObWzE50s="
  file_glob: true
  file: "/home/travis/${image_name}"
  on:
    all_branches: true
after_deploy:
- if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./scripts/releases_maintainer.sh;
  fi
- cd scripts && ./mail.py
after_failure:
- cd scripts && ./mail-fail.py
